<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Желаний | Ольга Васильева</title>
    
    <!-- Шрифты -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        deepBlue: '#0f172a',
                        gold: '#c5a059',
                        goldHover: '#b08d4b',
                        textMain: '#334155',
                        bgLight: '#f8fafc'
                    },
                    fontFamily: {
                        heading: ['Playfair Display', 'serif'],
                        body: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #334155;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Hero logic with rotation and mobile fix */
        .hero-bg {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            background-attachment: fixed; 
        }

        @media (hover: none) and (pointer: coarse) {
            .hero-bg {
                background-attachment: scroll; /* Mobile fix */
            }
        }

        .hero-overlay {
            background: linear-gradient(rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.7));
            position: absolute;
            inset: 0;
        }

        .card-shadow {
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            transition: all 0.4s ease;
        }
        .card-shadow:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.08);
        }
        .progress-fill {
            background-color: #c5a059;
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        /* Carousel Styles */
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(15, 23, 42, 0.5);
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background 0.3s;
        }
        .carousel-btn:hover { background: #c5a059; }
        .carousel-btn.prev { left: 10px; }
        .carousel-btn.next { right: 10px; }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, serverTimestamp, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDky1GyzGVypzyD-TxH38d84CsymtDZOmM",
            authDomain: "my-wishes-list.firebaseapp.com",
            projectId: "my-wishes-list",
            storageBucket: "my-wishes-list.firebasestorage.app",
            messagingSenderId: "825624373054",
            appId: "1:825624373054:web:1dd7a89173ec4d0dccee6f"
        };

        try {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.auth = getAuth(app);
            window.firebaseApi = {
                signInAnonymously,
                onAuthStateChanged,
                collection,
                addDoc,
                updateDoc,
                deleteDoc,
                doc,
                onSnapshot,
                query,
                serverTimestamp,
                getDocs,
                orderBy
            };
            window.appId = 'wishes-v1';
            window.dispatchEvent(new Event('firebase-ready'));
        } catch (e) {
            console.error("Firebase Initialization Error:", e);
        }
    </script>
</head>
<body>
    <div id="root">
        <div class="h-screen flex items-center justify-center bg-deepBlue">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gold mx-auto mb-4"></div>
                <p class="font-heading text-gold text-xl italic">Загрузка коллекции...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 5 ФОТО ДЛЯ РОТАЦИИ ФОНА ---
        const HERO_IMAGES = [
            "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?auto=format&fit=crop&w=1920&q=80", 
            "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=1920&q=80", 
            "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80", 
            "https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1920&q=80", 
            "https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1920&q=80"  
        ];

        // --- НОВЫЕ ЖЕЛАНИЯ ---
        const NEW_WISHES_TO_ADD = [
            { title: "Увидеть Памирское плато", fullDesc: "Путешествие на «Крышу мира». Проехать по Памирскому тракту, увидеть пики-семитысячники и высокогорные озера.", location: "Таджикистан", prep: "Внедорожник, акклиматизация", cost: "1500$", imageUrl: "https://images.unsplash.com/photo-1572098495639-6cb326c95332?auto=format&fit=crop&w=800", status: "planned", date: "2026", order: 100 },
            { title: "Пожить в Шанхайском отеле Shimao Deep pit", fullDesc: "Уникальный подземный отель, построенный в заброшенном карьере. Номера с видом на подводный мир.", location: "Китай, Шанхай", prep: "Виза, бронь за 3 месяца", cost: "500$/ночь", imageUrl: "https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=800", status: "planned", date: "2027", order: 101 },
            { title: "Посетить самый узкий город мира Яньцзинь", fullDesc: "Город, зажатый между горами и рекой. Ширина в самом узком месте всего 30 метров.", location: "Китай, Юньнань", prep: "Сложная логистика", cost: "1200$", imageUrl: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=800", status: "planned", date: "2028", order: 102 },
            { title: "Побывать на корабле «Васа»", fullDesc: "Единственный в мире сохранившийся корабль XVII века. Он затонул в 1628 году и был поднят спустя 333 года.", location: "Швеция, Стокгольм", prep: "Шенген", cost: "500$", imageUrl: "https://images.unsplash.com/photo-1520645521318-f03a712f0e67?auto=format&fit=crop&w=800", status: "planned", date: "2025", order: 103 },
            { title: "Походить по Белому Карману в Аризоне", fullDesc: "Фантастические пейзажи White Pocket. Сюрреалистичные скалы, до которых сложно добраться.", location: "США, Аризона", prep: "Аренда 4x4, навигатор", cost: "3500$", imageUrl: "https://images.unsplash.com/photo-1493329025335-18542a61595f?auto=format&fit=crop&w=800", status: "planned", date: "2026", order: 104 },
            { title: "Погулять у Кровавого водопада", fullDesc: "Кровавый водопад в Антарктиде — поток соленой воды богатой железом, вытекающий из ледника Тейлора.", location: "Антарктида", prep: "Экспедиционный тур", cost: "15000$", imageUrl: "https://images.unsplash.com/photo-1548206375-7b43c6b29090?auto=format&fit=crop&w=800", status: "planned", date: "2030", order: 105 },
            { title: "Отпуск на Ледоколе «Победа»", fullDesc: "Экспедиция на Северный полюс на атомном ледоколе «50 лет Победы».", location: "Северный Ледовитый океан", prep: "Бронь за год, теплая экипировка", cost: "25000$", imageUrl: "https://images.unsplash.com/photo-1520442373499-9f796a090b4d?auto=format&fit=crop&w=800", status: "planned", date: "2029", order: 106 },
            { title: "Экскурсия в Геркуланум", fullDesc: "Древнеримский город, погибший вместе с Помпеями, но сохранившийся намного лучше.", location: "Италия", prep: "Билеты онлайн", cost: "800$", imageUrl: "https://images.unsplash.com/photo-1552832230-c0197dd311b5?auto=format&fit=crop&w=800", status: "planned", date: "2025", order: 107 },
            { title: "Отпуск в Лихтенштейне", fullDesc: "Уютное княжество в Альпах. Замки, виноградники и горные тропы.", location: "Лихтенштейн", prep: "Шенген", cost: "2000$", imageUrl: "https://images.unsplash.com/photo-1600206277263-c793699b0629?auto=format&fit=crop&w=800", status: "planned", date: "2026", order: 108 },
            { title: "Побывать в Мале", fullDesc: "Столица Мальдив. Увидеть не только курорты, но и настоящую жизнь островитян, рыбный рынок и мечети.", location: "Мальдивы", prep: "Без визы", cost: "2500$", imageUrl: "https://images.unsplash.com/photo-1577791465664-b04052309f5b?auto=format&fit=crop&w=800", status: "planned", date: "2025", order: 109 }
        ];

        // --- ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ---
        
        const getHeroImage = () => {
            const indexStr = localStorage.getItem('heroIndex');
            let index = indexStr ? parseInt(indexStr, 10) : 0;
            const nextIndex = (index + 1) % HERO_IMAGES.length;
            localStorage.setItem('heroIndex', nextIndex);
            return HERO_IMAGES[index];
        };

        const getMediaType = (url) => {
            if (!url) return 'image';
            const ext = url.split('.').pop().split('?')[0].toLowerCase();
            if (['mp4', 'webm', 'ogg', 'mov'].includes(ext)) return 'video';
            return 'image'; 
        };

        // --- КОМПОНЕНТЫ ---

        const Hero = ({ completedCount, totalCount }) => {
            const [bgImage, setBgImage] = useState(HERO_IMAGES[0]);
            
            useEffect(() => {
                setBgImage(getHeroImage());
            }, []);

            const percent = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
            
            return (
                <header 
                    className="hero-bg h-screen min-h-[600px] flex flex-col justify-center items-center text-center text-white px-4 relative"
                    style={{ backgroundImage: `url('${bgImage}')` }}
                >
                    <div className="hero-overlay"></div>
                    <div className="max-w-4xl z-10 animate-fade-in relative">
                        <h1 className="font-heading text-6xl md:text-8xl font-bold mb-6 tracking-widest hero-title">
                            100 ЖЕЛАНИЙ
                        </h1>
                        <h2 className="font-heading text-xl md:text-2xl italic text-slate-200 mb-8 font-light">
                            Личный виш-лист приключений Васильевой Ольги для яркой жизни
                        </h2>
                        <div className="hero-quote py-4 mb-12 inline-block">
                            <p className="font-body text-lg md:text-xl tracking-wide opacity-90 font-light">
                                «Мир слишком велик, чтобы сидеть на месте. Начинаем охоту за впечатлениями!»
                            </p>
                        </div>
                        
                        <div className="w-full max-w-lg mx-auto text-left">
                            <span className="block text-gold text-xs tracking-[0.2em] uppercase mb-3 text-center">
                                Исполнено {completedCount} из {totalCount} желаний ({percent}%)
                            </span>
                            <div className="progress-track h-1 rounded-full overflow-hidden bg-white/20">
                                <div 
                                    className="progress-fill h-full"
                                    style={{ width: `${percent}%` }}
                                ></div>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        const WishCard = ({ wish, onClick }) => {
            return (
                <div 
                    className="card-shadow bg-white rounded-sm flex flex-col h-full cursor-pointer group"
                    onClick={() => onClick(wish)}
                >
                    <div className="h-72 overflow-hidden relative">
                        <img 
                            src={wish.imageUrl} 
                            alt={wish.title} 
                            loading="lazy"
                            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                            onError={(e) => { e.target.src = 'https://via.placeholder.com/600x400?text=No+Image'; }}
                        />
                        <div className="absolute top-4 right-4">
                             <span className={`px-3 py-1 text-[10px] font-bold uppercase tracking-widest rounded-full ${wish.status === 'done' ? 'bg-gold text-white' : 'bg-white/90 text-deepBlue'}`}>
                                {wish.status === 'done' ? 'Выполнено' : 'В планах'}
                            </span>
                        </div>
                    </div>
                    <div className="p-8 flex flex-col flex-grow">
                        <h4 className="font-heading text-2xl text-deepBlue mb-4 leading-tight group-hover:text-gold transition-colors">
                            {wish.title}
                        </h4>
                        <div className="mt-auto pt-6 border-t border-slate-100 flex justify-between items-center text-sm">
                            <span className="text-slate-400 text-xs font-bold uppercase tracking-widest">
                                {wish.location}
                            </span>
                            <span className="italic text-slate-500">
                                {wish.status === 'done' ? wish.date : wish.date}
                            </span>
                        </div>
                    </div>
                </div>
            );
        };

        const Modal = ({ wish, onClose }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            
            if (!wish) return null;

            const gallery = (wish.gallery && wish.gallery.length > 0) 
                ? wish.gallery 
                : [wish.imageUrl];

            const handleNext = (e) => {
                e.stopPropagation();
                setCurrentIndex((prev) => (prev + 1) % gallery.length);
            };

            const handlePrev = (e) => {
                e.stopPropagation();
                setCurrentIndex((prev) => (prev - 1 + gallery.length) % gallery.length);
            };

            const currentMedia = gallery[currentIndex];
            const isVideo = getMediaType(currentMedia) === 'video';

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-deepBlue/95 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white w-full max-w-5xl max-h-[90vh] overflow-y-auto rounded-sm grid md:grid-cols-2 shadow-2xl animate-fade-in" onClick={e => e.stopPropagation()}>
                        
                        <div className="h-64 md:h-auto relative bg-black flex items-center justify-center overflow-hidden group">
                            {gallery.length > 1 && (
                                <>
                                    <div className="carousel-btn prev" onClick={handlePrev}>&#10094;</div>
                                    <div className="carousel-btn next" onClick={handleNext}>&#10095;</div>
                                    <div className="absolute bottom-4 left-0 right-0 flex justify-center gap-2 z-10">
                                        {gallery.map((_, idx) => (
                                            <div key={idx} className={`w-2 h-2 rounded-full ${idx === currentIndex ? 'bg-gold' : 'bg-white/50'}`}></div>
                                        ))}
                                    </div>
                                </>
                            )}
                            
                            {isVideo ? (
                                <video 
                                    src={currentMedia} 
                                    controls 
                                    className="w-full h-full object-contain"
                                    poster={wish.imageUrl} 
                                >
                                    Ваш браузер не поддерживает видео.
                                </video>
                            ) : (
                                <img src={currentMedia} className="w-full h-full object-cover" alt={wish.title}/>
                            )}
                        </div>

                        <div className="p-10 relative flex flex-col">
                            <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-deepBlue text-3xl z-20">&times;</button>
                            
                            <div className="mb-6">
                                <span className={`inline-block mb-4 px-3 py-1 text-xs font-bold uppercase tracking-wider border ${wish.status === 'done' ? 'border-gold text-gold' : 'border-slate-300 text-slate-400'}`}>
                                    {wish.status === 'done' ? 'Цель достигнута' : 'В планах'}
                                </span>
                                <h3 className="font-heading text-3xl md:text-4xl text-deepBlue font-bold">{wish.title}</h3>
                            </div>

                            <div className="space-y-6 text-slate-600 font-body flex-grow">
                                <p className="text-lg leading-relaxed">{wish.fullDesc}</p>
                                
                                <div className="grid grid-cols-2 gap-6 pt-4 border-t border-slate-100">
                                    <div>
                                        <h5 className="font-bold text-deepBlue uppercase tracking-wide text-xs mb-1">Где</h5>
                                        <p>{wish.location}</p>
                                    </div>
                                    <div>
                                        <h5 className="font-bold text-deepBlue uppercase tracking-wide text-xs mb-1">Цена</h5>
                                        <p>{wish.cost}</p>
                                    </div>
                                </div>

                                <div>
                                    <h5 className="font-bold text-deepBlue uppercase tracking-wide text-xs mb-1">Подготовка</h5>
                                    <p>{wish.prep}</p>
                                </div>

                                {wish.link && (
                                    <div className="pt-2">
                                        <a href={wish.link} target="_blank" className="text-gold font-bold uppercase text-xs tracking-widest hover:text-deepBlue transition-colors border-b border-gold pb-1">
                                            Ссылка на ресурс &rarr;
                                        </a>
                                    </div>
                                )}

                                {wish.status === 'done' && <p className="text-gold italic mt-4">Выполнено: {wish.date}</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AdminPanel = ({ onLogout }) => {
            const [activeTab, setActiveTab] = useState('wishes');
            const [wishes, setWishes] = useState([]);
            const [messages, setMessages] = useState([]);
            const [editing, setEditing] = useState(null);

            // Состояние для 10 инпутов медиа
            const [mediaInputs, setMediaInputs] = useState(Array(10).fill(''));

            useEffect(() => {
                const { db, firebaseApi, appId } = window;
                if (!db) return;

                const wishesRef = firebaseApi.collection(db, 'artifacts', appId, 'public', 'data', 'wishes');
                const messagesRef = firebaseApi.collection(db, 'artifacts', appId, 'public', 'data', 'messages');

                const unsubWishes = firebaseApi.onSnapshot(wishesRef, (snap) => {
                    const data = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    data.sort((a, b) => (a.order || 0) - (b.order || 0));
                    setWishes(data);
                });
                
                const unsubMsgs = firebaseApi.onSnapshot(messagesRef, (snap) => {
                    setMessages(snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => b.createdAt - a.createdAt));
                });

                return () => { unsubWishes(); unsubMsgs(); };
            }, []);

            // Инициализация полей медиа при открытии редактирования
            useEffect(() => {
                if (editing) {
                    const initialMedia = Array(10).fill('');
                    if (editing.gallery && editing.gallery.length > 0) {
                        editing.gallery.forEach((url, i) => {
                            if (i < 10) initialMedia[i] = url;
                        });
                    } else if (editing.imageUrl) {
                        initialMedia[0] = editing.imageUrl;
                    }
                    setMediaInputs(initialMedia);
                } else {
                    setMediaInputs(Array(10).fill(''));
                }
            }, [editing]);

            const handleMediaChange = (index, value) => {
                const newInputs = [...mediaInputs];
                newInputs[index] = value;
                setMediaInputs(newInputs);
            };

            const handleSave = async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const rawData = Object.fromEntries(formData);
                
                // Собираем галерею из 10 полей
                const galleryUrls = mediaInputs.filter(url => url.trim().length > 0);
                
                // Главное фото - первое непустое поле, или заглушка
                const mainImage = galleryUrls.length > 0 ? galleryUrls[0] : (rawData.imageUrl || ''); 
                
                const saveData = {
                    title: rawData.title,
                    fullDesc: rawData.fullDesc,
                    location: rawData.location,
                    cost: rawData.cost,
                    prep: rawData.prep,
                    status: rawData.status,
                    date: rawData.date,
                    link: rawData.link,
                    imageUrl: mainImage,
                    gallery: galleryUrls,
                    order: editing.order || Date.now()
                };

                const { db, firebaseApi, appId } = window;
                try {
                    if (editing?.id) {
                        await firebaseApi.updateDoc(firebaseApi.doc(db, 'artifacts', appId, 'public', 'data', 'wishes', editing.id), saveData);
                    } else {
                        await firebaseApi.addDoc(firebaseApi.collection(db, 'artifacts', appId, 'public', 'data', 'wishes'), {
                            ...saveData,
                            createdAt: new Date().toISOString()
                        });
                    }
                    setEditing(null);
                } catch(err) { alert('Ошибка: ' + err.message); }
            };

            const handleDelete = async (id) => {
                if(!confirm('Удалить?')) return;
                const { db, firebaseApi, appId } = window;
                await firebaseApi.deleteDoc(firebaseApi.doc(db, 'artifacts', appId, 'public', 'data', 'wishes', id));
            };

            const moveItem = async (index, direction) => {
                const newWishes = [...wishes];
                if (direction === 'up' && index > 0) {
                    [newWishes[index], newWishes[index - 1]] = [newWishes[index - 1], newWishes[index]];
                } else if (direction === 'down' && index < newWishes.length - 1) {
                    [newWishes[index], newWishes[index + 1]] = [newWishes[index + 1], newWishes[index]];
                } else {
                    return;
                }

                const { db, firebaseApi, appId } = window;
                const batchPromises = newWishes.map((w, idx) => 
                    firebaseApi.updateDoc(firebaseApi.doc(db, 'artifacts', appId, 'public', 'data', 'wishes', w.id), { order: idx })
                );
                await Promise.all(batchPromises);
            };

            return (
                <div className="min-h-screen bg-slate-100 font-body">
                    <nav className="bg-deepBlue text-white p-4 sticky top-0 z-50 flex justify-between items-center">
                        <h1 className="font-heading text-xl text-gold">Admin Panel</h1>
                        <div className="flex gap-4 text-sm">
                            <button onClick={() => { setActiveTab('wishes'); setEditing(null); }} className={activeTab === 'wishes' ? 'text-gold font-bold' : 'opacity-70'}>Желания</button>
                            <button onClick={() => setActiveTab('messages')} className={activeTab === 'messages' ? 'text-gold font-bold' : 'opacity-70'}>Сообщения</button>
                            <button onClick={onLogout} className="text-red-400 border border-red-400 px-3 py-1 rounded hover:bg-red-400 hover:text-white transition">Выйти</button>
                        </div>
                    </nav>
                    
                    <main className="p-4 md:p-8 max-w-5xl mx-auto">
                        {activeTab === 'wishes' && !editing && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-deepBlue">Список желаний ({wishes.length})</h2>
                                    <button onClick={() => setEditing({})} className="bg-gold text-white px-6 py-3 rounded shadow hover:bg-goldHover font-bold uppercase text-xs tracking-widest">+ Добавить</button>
                                </div>
                                <div className="space-y-3">
                                    {wishes.map((w, index) => (
                                        <div key={w.id} className="bg-white p-4 rounded shadow flex flex-col md:flex-row justify-between items-center gap-4">
                                            <div className="flex gap-4 items-center flex-grow w-full">
                                                <div className="flex flex-col gap-1">
                                                    <button onClick={() => moveItem(index, 'up')} disabled={index===0} className="text-slate-400 hover:text-deepBlue disabled:opacity-20">▲</button>
                                                    <button onClick={() => moveItem(index, 'down')} disabled={index===wishes.length-1} className="text-slate-400 hover:text-deepBlue disabled:opacity-20">▼</button>
                                                </div>
                                                <img src={w.imageUrl} className="w-16 h-16 object-cover rounded shadow-sm" alt=""/>
                                                <div>
                                                    <div className="font-bold text-deepBlue text-lg">{w.title}</div>
                                                    <span className={`text-[10px] px-2 py-1 rounded uppercase tracking-widest ${w.status==='done' ? 'bg-green-100 text-green-800' : 'bg-slate-100 text-slate-500'}`}>{w.status}</span>
                                                </div>
                                            </div>
                                            <div className="flex gap-3 w-full md:w-auto justify-end">
                                                <button onClick={() => setEditing(w)} className="text-blue-600 hover:underline text-sm uppercase font-bold tracking-wider">Ред.</button>
                                                <button onClick={() => handleDelete(w.id)} className="text-red-600 hover:underline text-sm uppercase font-bold tracking-wider">Удал.</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'wishes' && editing && (
                            <form onSubmit={handleSave} className="bg-white p-8 rounded shadow-lg space-y-6 max-w-3xl mx-auto">
                                <div className="flex justify-between items-center border-b pb-4">
                                    <h2 className="text-2xl font-bold text-deepBlue">{editing.id ? 'Редактировать желание' : 'Новое желание'}</h2>
                                    <button type="button" onClick={() => setEditing(null)} className="text-slate-400 hover:text-red-500 text-2xl">&times;</button>
                                </div>
                                
                                <div className="grid gap-6">
                                    <div>
                                        <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Название</label>
                                        <input name="title" defaultValue={editing.title} required className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none" />
                                    </div>

                                    <div>
                                        <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Полное описание</label>
                                        <textarea name="fullDesc" defaultValue={editing.fullDesc} className="w-full border border-slate-300 p-3 rounded h-32 focus:border-gold outline-none" />
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Локация</label>
                                            <input name="location" defaultValue={editing.location} className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Стоимость</label>
                                            <input name="cost" defaultValue={editing.cost} className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none" />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Подготовка</label>
                                        <input name="prep" defaultValue={editing.prep} className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none" />
                                    </div>

                                    <div>
                                        <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Ссылка на ресурс (информация о желании)</label>
                                        <input name="link" defaultValue={editing.link} placeholder="https://..." className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none text-blue-600" />
                                    </div>

                                    <div className="bg-slate-50 p-4 rounded border border-slate-200">
                                        <h4 className="font-bold text-deepBlue mb-4">Медиа файлы (Фото/Видео)</h4>
                                        <p className="text-xs text-slate-400 mb-4">Вставьте ссылки (URL). Первая заполненная строка станет главным фото.</p>
                                        
                                        <div className="space-y-2">
                                            {mediaInputs.map((val, i) => (
                                                <div key={i} className="flex items-center gap-2">
                                                    <span className="text-xs text-slate-400 w-6">{i + 1}.</span>
                                                    <input 
                                                        value={val} 
                                                        onChange={(e) => handleMediaChange(i, e.target.value)}
                                                        placeholder={i === 0 ? "Ссылка на главное фото/видео" : "Ссылка на фото/видео"} 
                                                        className="w-full border border-slate-300 p-2 rounded text-sm focus:border-gold outline-none" 
                                                    />
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Статус</label>
                                            <select name="status" defaultValue={editing.status || 'planned'} className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none bg-white">
                                                <option value="planned">В планах</option>
                                                <option value="done">Выполнено</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Дата / Год</label>
                                            <input name="date" defaultValue={editing.date} className="w-full border border-slate-300 p-3 rounded focus:border-gold outline-none" />
                                        </div>
                                    </div>
                                </div>

                                <div className="flex justify-end gap-3 pt-6 border-t">
                                    <button type="button" onClick={() => setEditing(null)} className="px-6 py-3 border border-slate-300 rounded hover:bg-slate-50 text-slate-600 font-bold uppercase text-xs tracking-widest">Отмена</button>
                                    <button type="submit" className="px-8 py-3 bg-gold text-white rounded hover:bg-goldHover font-bold uppercase text-xs tracking-widest shadow-lg">Сохранить</button>
                                </div>
                            </form>
                        )}

                        {activeTab === 'messages' && (
                            <div className="bg-white rounded shadow overflow-hidden">
                                {messages.length === 0 && <div className="p-8 text-center text-slate-400">Сообщений пока нет</div>}
                                {messages.map(m => (
                                    <div key={m.id} className="p-6 border-b hover:bg-slate-50 transition-colors">
                                        <div className="flex justify-between items-start mb-2">
                                            <span className="font-bold text-deepBlue text-lg">{m.email}</span>
                                            <span className="text-xs text-slate-400">{m.createdAt?.seconds ? new Date(m.createdAt.seconds*1000).toLocaleString() : ''}</span>
                                        </div>
                                        <p className="text-slate-600 bg-slate-100 p-3 rounded">{m.text || m.message}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const MainApp = () => {
            const [view, setView] = useState('public');
            const [wishes, setWishes] = useState([]);
            const [selectedWish, setSelectedWish] = useState(null);
            const [loading, setLoading] = useState(true);
            const [contactStatus, setContactStatus] = useState('');
            const [user, setUser] = useState(null);
            const [isDemo, setIsDemo] = useState(false);

            useEffect(() => {
                const initApp = async () => {
                    const { db, auth, firebaseApi, appId } = window;
                    
                    if (!firebaseApi) {
                        setIsDemo(true);
                        setLoading(false);
                        return;
                    }

                    // Слушатель Auth
                    firebaseApi.onAuthStateChanged(auth, async (u) => {
                        setUser(u);
                        const wishesRef = firebaseApi.collection(db, 'artifacts', appId, 'public', 'data', 'wishes');
                        
                        try {
                            const snapshot = await firebaseApi.getDocs(wishesRef);
                            
                            // СИДИНГ НОВЫХ ЖЕЛАНИЙ (проверка на дубликаты по названию)
                            if (u) { // Только если есть доступ к записи
                                const existingTitles = new Set(snapshot.docs.map(d => d.data().title));
                                const batchPromises = [];
                                
                                NEW_WISHES_TO_ADD.forEach(newWish => {
                                    if (!existingTitles.has(newWish.title)) {
                                        console.log(`Adding new wish: ${newWish.title}`);
                                        batchPromises.push(firebaseApi.addDoc(wishesRef, {
                                            ...newWish,
                                            createdAt: new Date().toISOString()
                                        }));
                                    }
                                });
                                if(batchPromises.length > 0) await Promise.all(batchPromises);
                            }

                            // Realtime слушатель
                            firebaseApi.onSnapshot(wishesRef, (snap) => {
                                const data = snap.docs.map(d => ({id: d.id, ...d.data()}));
                                // Сортировка по order
                                data.sort((a,b) => (a.order || 0) - (b.order || 0));
                                setWishes(data);
                                setLoading(false);
                            });
                        } catch (e) {
                            console.error("DB Error:", e);
                            setIsDemo(true);
                            setLoading(false);
                        }
                    });

                    // Анонимный вход
                    try {
                        await firebaseApi.signInAnonymously(auth);
                    } catch (err) {
                        console.error("Auth Error:", err);
                        setIsDemo(true);
                        setLoading(false);
                    }
                };

                if (window.firebaseApi) initApp();
                else window.addEventListener('firebase-ready', initApp);
            }, []);

            const sendMsg = async (e) => {
                e.preventDefault();
                const form = e.target;
                const email = form.email.value;
                const text = form.message.value;
                
                try {
                    const { db, firebaseApi, appId } = window;
                    await firebaseApi.addDoc(firebaseApi.collection(db, 'artifacts', appId, 'public', 'data', 'messages'), {
                        email, text, createdAt: firebaseApi.serverTimestamp()
                    });
                    setContactStatus('Сообщение отправлено!');
                    form.reset();
                    setTimeout(() => setContactStatus(''), 3000);
                } catch(err) {
                    setContactStatus('Ошибка отправки.');
                }
            };

            const handleLoginAttempt = (e) => {
                e.preventDefault();
                const pass = e.target.password.value;
                if(pass === 'admin123') setView('admin');
                else alert('Неверный пароль');
            };

            if (loading) return null;

            if (view === 'admin') return <AdminPanel onLogout={() => setView('public')} />;

            if (view === 'login') return (
                <div className="h-screen bg-deepBlue flex items-center justify-center p-4">
                    <form onSubmit={handleLoginAttempt} className="bg-white p-8 rounded text-center shadow-2xl max-w-sm w-full">
                        <h2 className="font-heading text-2xl mb-6 text-deepBlue">Вход в систему</h2>
                        <input name="password" type="password" placeholder="Пароль" className="border p-3 w-full mb-6 outline-none focus:border-gold rounded" autoFocus />
                        <div className="flex justify-between gap-4">
                            <button type="button" onClick={() => setView('public')} className="text-slate-500 hover:text-deepBlue text-sm">Назад</button>
                            <button className="bg-gold text-white px-8 py-2 rounded hover:bg-goldHover font-bold uppercase text-xs tracking-widest">Войти</button>
                        </div>
                    </form>
                </div>
            );

            // Публичная часть
            return (
                <div className="min-h-screen flex flex-col">
                    <Hero completedCount={wishes.filter(w => w.status==='done').length} totalCount={wishes.length} />
                    
                    <main className="flex-grow px-4 py-20 bg-bgLight">
                        <div className="max-w-7xl mx-auto">
                            <div className="text-center mb-16">
                                <h3 className="font-heading text-4xl md:text-5xl text-deepBlue mb-4">Коллекция впечатлений</h3>
                                <div className="w-24 h-1 bg-gold mx-auto"></div>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-12">
                                {wishes.map(wish => (
                                    <WishCard key={wish.id} wish={wish} onClick={setSelectedWish} />
                                ))}
                            </div>
                        </div>
                    </main>

                    <footer className="bg-deepBlue text-white py-20 px-4">
                        <div className="max-w-xl mx-auto text-center">
                            <h3 className="font-heading text-3xl text-gold mb-8">Написать автору</h3>
                            {contactStatus ? (
                                <div className="text-green-400 border border-green-500 p-4 rounded mb-8">{contactStatus}</div>
                            ) : (
                                <form onSubmit={sendMsg} className="flex flex-col gap-4 text-left">
                                    <textarea name="message" rows="4" placeholder="Ваше сообщение" className="bg-white/5 border border-white/10 p-4 text-white placeholder-gray-500 focus:border-gold outline-none rounded" required></textarea>
                                    <input name="email" type="text" placeholder="Ваш Email или Telegram" className="bg-white/5 border border-white/10 p-4 text-white placeholder-gray-500 focus:border-gold outline-none rounded" required />
                                    <button className="bg-gold text-white py-4 font-bold tracking-widest uppercase hover:bg-goldHover transition-colors rounded">Отправить</button>
                                </form>
                            )}
                            <button onClick={() => setView('login')} className="mt-16 text-xs text-white/20 uppercase tracking-widest hover:text-white transition-colors">Войти (Admin)</button>
                        </div>
                    </footer>

                    <Modal wish={selectedWish} onClose={() => setSelectedWish(null)} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MainApp />);
    </script>
</body>
</html>